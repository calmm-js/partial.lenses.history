!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("infestines"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","infestines","partial.lenses"],r):r(n.H={},n.I,n.L)}(this,function(n,a,r){"use strict";function c(n){for(var r=0;i<<r<n;)r+=p;return r}function s(n,r){n+=r.l;for(var t=c(r.u),e=r.r;0!==t;)e=e[n>>t&m],t-=p;return e[n&m]}function v(n,r,t,e){for(var u=r>>n&m,i=0!==n?v(n-p,r,t,e[u]||""):t,o=[],f=0,c=e.length;f<c;++f)o[f]=e[f];return o[u]=i,o}function l(n,r){var t=r.u,e=c(t),u=r.r;return x(r.l,t+1,t>>e<i?v(e,t,n,u):[u,v(e,t,n,"")])}function d(n,r,t){if(r<=n)return y;if(0===n&&h(t)===r)return t;for(var e=t.l+n,u=e+r-n,i=t.r,o=c(t.u);0!==o&&(e>>o&m)==(u-1>>o&m);){var f=e&m<<o;i=i[e>>o&m],e-=f,u-=f,o-=p}return t.u!==u&&(i=function n(r,t,e){for(var u=t>>r&m,i=0!==r?n(r-p,t,e[u]):e[u],o=[],f=0;f<u;++f)o[f]=e[f];return o[u]=i,o}(o,u-1,i)),t.l!==e&&(i=function n(r,t,e){for(var u=t>>r&m,i=0!==r?n(r-p,t,e[u]):e[u],o=[],f=0;f<u;++f)o[f]=null;o[u]=i;for(var c=u+1,a=e.length;c<a;++c)o[c]=e[c];return o}(o,e,i)),x(e,u,i)}function t(n,r){var t=r.v,e=r.i,u=r.c;if(u.e&&a.acyclicEqualsU(s(e,t),n))return r;var i=r.t,o=Date.now(),f=e+(u.p<=o-s(e,i)),c=Math.max(0,f-u.m);return w(f-c,l(o,d(c,f,i)),l(n,d(c,f,t)),u)}var p=4,i=1<<p,m=i-1,x=function(n,r,t){return{l:n,u:r,r:t}},y=x(0,0,[]),e=function(n){return x(0,1,[n])},h=function(n){return n.u-n.l},u=function(n,r){return d(n,h(r),r)},o=function(n,r){return d(0,n,r)},f=function(n){return n-1},w=function(n,r,t,e){return{i:n,t:r,v:t,c:e}},C=function(n,r){return w(Math.max(0,Math.min(n,g(r)-1)),r.t,r.v,r.c)},M=a.curryN(2,function(n){var r={p:(n=n||0).replacePeriod||0,e:!n.pushEquals,m:Math.max(1,n.maxCount||-1>>>1)-1};return function(n){return w(0,e(Date.now()),e(n),r)}}),g=function(n){return h(n.v)},q=function(n){return n.i},P=a.curry(C),I=r.lens(q,C),b=function(n){return s(n.i,n.v)},j=a.curry(t),D=r.lens(b,t),E=r.modify(I,f),F=function(n){return g(n)-1-n.i},U=r.lens(F,function(n,r){return P(g(r)-1-n,r)}),_=r.modify(U,f);n.init=M,n.count=g,n.index=q,n.setIndex=P,n.viewIndex=I,n.present=b,n.setPresent=j,n.viewPresent=D,n.undoCount=q,n.viewUndoCount=I,n.undo=E,n.undoForget=function(n){return w(0,u(n.i,n.t),u(n.i,n.v),n.c)},n.redoCount=F,n.viewRedoCount=U,n.redo=_,n.redoForget=function(n){return w(n.i,o(n.i+1,n.t),o(n.i+1,n.v),n.c)},Object.defineProperty(n,"__esModule",{value:!0})});

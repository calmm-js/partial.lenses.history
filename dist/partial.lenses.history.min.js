!function(n,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("infestines"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","infestines","partial.lenses"],r):r(n.H={},n.I,n.L)}(this,function(n,a,r){"use strict";function c(n){for(var r=0;i<<r<n;)r+=p;return r}function l(n,r){n+=r.l;for(var t=c(r.u),e=r.r;0!==t;)e=e[n>>t&x],t-=p;return e[n&x]}function s(n,r,t,e){for(var u=r>>n&x,i=0!==n?s(n-p,r,t,e[u]||""):t,o=[],f=0,c=e.length;f<c;++f)o[f]=e[f];return o[u]=i,o}function v(n,r){var t=r.u,e=c(t),u=r.r;return m(r.l,t+1,t>>e<i?s(e,t,n,u):[u,s(e,t,n,"")])}function d(n,r,t){if(r<=n)return h;if(0===n&&y(t)===r)return t;for(var e=t.l+n,u=e+r-n,i=t.r,o=c(t.u);0!==o&&(e>>o&x)==(u-1>>o&x);){var f=e&x<<o;i=i[e>>o&x],e-=f,u-=f,o-=p}return t.u!==u&&(i=function n(r,t,e){for(var u=t>>r&x,i=0!==r?n(r-p,t,e[u]):e[u],o=[],f=0;f<u;++f)o[f]=e[f];return o[u]=i,o}(o,u-1,i)),t.l!==e&&(i=function n(r,t,e){for(var u=t>>r&x,i=0!==r?n(r-p,t,e[u]):e[u],o=[],f=0;f<u;++f)o[f]=null;o[u]=i;for(var c=u+1,a=e.length;c<a;++c)o[c]=e[c];return o}(o,e,i)),m(e,u,i)}function t(n,r){var t=r.v,e=r.i,u=r.c;if(u.e&&a.acyclicEqualsU(l(e,t),n))return r;var i=r.t,o=Date.now(),f=e+(u.p<=o-l(e,i)),c=Math.max(0,f-u.m);return M(f-c,v(o,d(c,f,i)),v(n,d(c,f,t)),u)}var p=4,i=1<<p,x=i-1,m=function(n,r,t){return{l:n,u:r,r:t}},h=m(0,0,[]),e=function(n){return m(0,1,[n])},y=function(n){return n.u-n.l},u=function(n,r){return d(n,y(r),r)},o=function(n,r){return d(0,n,r)},M=function(n,r,t,e){return{i:n,t:r,v:t,c:e}},f=function(n,r){return M(Math.max(0,Math.min(n,q(r)-1)),r.t,r.v,r.c)},g=a.curryN(2,function(n){var r={p:(n=n||0).replacePeriod||0,e:!n.pushEquals,m:Math.max(1,n.maxCount||-1>>>1)-1};return function(n){return M(0,e(Date.now()),e(n),r)}}),q=function(n){return y(n.v)},I=r.lens(function(n){return n.i},f),b=r.lens(function(n){return l(n.i,n.v)},t),j=r.lens(function(n){return q(n)-1-n.i},function(n,r){return f(q(r)-1-n,r)});n.init=g,n.count=q,n.index=I,n.present=b,n.undoIndex=I,n.undoForget=function(n){return M(0,u(n.i,n.t),u(n.i,n.v),n.c)},n.redoIndex=j,n.redoForget=function(n){return M(n.i,o(n.i+1,n.t),o(n.i+1,n.v),n.c)},Object.defineProperty(n,"__esModule",{value:!0})});
